SessionKey="ba4ddd336ec3ca5dea2f2c7d9e2ba201";Ext.onReady(function(){App=new SABnzbd.application()});Ext.ns("SABnzbd","SABnzbd.controllers","SABnzbd.views","SABnzbd.views.application","SABnzbd.views.queue","SABnzbd.views.history","SABnzbd.views.file","SABnzbd.views.connection","SABnzbd.views.warning","SABnzbd.views.config");SABnzbd.application=Ext.extend(Ext.util.Observable,{host:"http://192.168.1.69:8080/",controllers:{},constructor:function(){this.addEvents("launch");SABnzbd.application.superclass.constructor.call(this);this.initControllers.defer(100);this.initViewport();this.fireEvent("launch",this)},initControllers:function(){for(controller in SABnzbd.controllers){this[controller]=new SABnzbd.controllers[controller]}},initViewport:function(){this.viewport=new SABnzbd.views.application.Viewport()}});SABnzbd.controllers.ApplicationController=Ext.extend(Ext.util.Observable,{constructor:function(){SABnzbd.application.superclass.constructor.call(this);this.initListeners();this.init()},initListeners:function(){},init:function(){}});SABnzbd.controllers.QueueController=Ext.extend(SABnzbd.controllers.ApplicationController,{initListeners:function(){},init:function(){this.load()},load:function(){Ext.Ajax.request({url:String.format("{0}tapi?mode=queue&start=START&limit=LIMIT&output=json&session={1}",App.host||"",SessionKey),success:function(A){var C=Ext.decode(A.responseText);console.log(C);return;Ext.getCmp("warningstab").setTitle("Warnings("+C.queue.have_warnings+")");for(count=MyStore.getCount();count<C.queue.slots.length;count++){var B=new Ext.data.Record();MyStore.add(B)}for(count=C.queue.slots.length;count<MyStore.getCount();count++){MyStore.removeAt(count)}for(count=0;count<C.queue.slots.length;count++){if(C.queue.slots[count].status=="Paused"){buttons='<img style="cursor: pointer;" onclick="queueresume(\''+C.queue.slots[count].nzo_id+'\')" src="../static/images/play.png">'}else{buttons='<img style="cursor: pointer;" onclick="queuepause(\''+C.queue.slots[count].nzo_id+'\')" src="../static/images/pause.png">'}buttons+=" ";buttons+='<img style="cursor: pointer;" onclick="queuedelete(\''+C.queue.slots[count].nzo_id+'\')" src="../static/images/delete.png">';buttons+=" ";buttons+='<img style="cursor: pointer;" onclick="queueinfo(\''+C.queue.slots[count].nzo_id+'\')" src="../static/images/info.png">';MyStore.getAt(count).set("buttons",buttons);MyStore.getAt(count).set("nzo_id",C.queue.slots[count].nzo_id);MyStore.getAt(count).set("filename",C.queue.slots[count].filename);MyStore.getAt(count).set("timeleft",C.queue.slots[count].timeleft);MyStore.getAt(count).set("size",C.queue.slots[count].sizeleft.substring(0,C.queue.slots[count].sizeleft.length-3)+"/"+C.queue.slots[count].size+" ("+C.queue.slots[count].percentage+" %)");MyStore.getAt(count).set("percentage",'<div style="height:11px;border:1px dotted #000000"><div style="height:11px;font-size:9px;background:#FF6666;width:'+C.queue.slots[count].percentage+'%"></div></div>');MyStore.getAt(count).set("avg_age",C.queue.slots[count].avg_age);MyStore.getAt(count).set("cat",C.queue.slots[count].cat);MyStore.getAt(count).set("status",'<div class="'+C.queue.slots[count].status+'">'+C.queue.slots[count].status+"</div>")}Ext.getCmp("speed").setValue(C.queue.kbpersec);Ext.getCmp("status").setValue('<div class="'+C.queue.status+'">'+C.queue.status+"</div>");Ext.getCmp("freespace").setValue(C.queue.diskspace1+"/"+C.queue.diskspacetotal1+" MB");Ext.getCmp("queuetab").setIconClass("");if(reload){if(maintab=="historytab"){setTimeout("loadhistory(true)",1000)}if(maintab=="queuetab"){if(queuetab=="filestab"){if(SABid!=""){loadfiles(true)}else{Ext.getCmp(queuetab).setIconClass("file-icon");setTimeout("loadqueue(true)",1000)}}if(queuetab=="connectionstab"){loadconnections(true)}if(queuetab=="warningstab"){loadwarnings(true)}}}}})}});SABnzbd.views.application.Menu=Ext.extend(Ext.Panel,{initComponent:function(){Ext.applyIf(this,{height:127,layout:"border",items:[{region:"north",xtype:"toolbar",height:27,buttonAlign:"right",items:[{text:"Configuration",handler:function(){}}]},{region:"center",html:"SABnzbd!",border:false}]});SABnzbd.views.queue.Index.superclass.initComponent.apply(this,arguments)}});SABnzbd.views.application.Viewport=Ext.extend(Ext.Viewport,{initComponent:function(){this.menu=new SABnzbd.views.application.Menu({region:"north"});this.queue=new SABnzbd.views.queue.Index();this.file=new SABnzbd.views.file.Grid();Ext.applyIf(this,{layout:"border",defaults:{border:false},items:[this.menu,{region:"center",xtype:"tabpanel",border:true,bodyStyle:"border-width:1px 0",activeTab:0,items:[this.queue]},{region:"south",xtype:"tabpanel",height:200,activeTab:0,items:[this.file]}]});SABnzbd.views.application.Viewport.superclass.initComponent.apply(this,arguments)}});SABnzbd.views.file.Grid=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){Ext.applyIf(this,{title:"Files",store:new Ext.data.Store(),autoExpandColumn:1,disableSelection:true,viewConfig:{getRowClass:function(A,D,B,C){if(A.get("status")=="finished"){return"finishedrow"}if(A.get("status")=="queued"){return"queuedrow"}}},columns:[{header:"Status",sortable:true,resizable:true,dataIndex:"status"},{header:"Filename",sortable:true,resizable:true,dataIndex:"filename"},{header:"%",sortable:true,resizable:true,dataIndex:"percentage"},{header:"Size",sortable:true,resizable:true,dataIndex:"size",align:"right"}]});SABnzbd.views.file.Grid.superclass.initComponent.apply(this,arguments);this.initListeners()},initListeners:function(){}});SABnzbd.views.queue.Index=Ext.extend(Ext.Panel,{initComponent:function(){this.grid=new SABnzbd.views.queue.Grid();Ext.applyIf(this,{title:"Queue",defaults:{border:false},items:[this.grid]});SABnzbd.views.queue.Index.superclass.initComponent.apply(this,arguments)}});SABnzbd.views.queue.Grid=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){Ext.applyIf(this,{store:new Ext.data.Store(),autoExpandColumn:"filename",margins:"0 0 10 0",enableDragDrop:true,ddGroup:"queue-dd",ddText:"Place this row.",sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{beforerowselect:function(D,B,A,C){Ext.getCmp("queuegrid").ddText=C.get("filename")}}}),columns:[{sortable:true,resizable:true,width:55,dataIndex:"buttons",menuDisabled:true},{header:"Category",sortable:true,resizable:true,width:60,dataIndex:"cat",menuDisabled:true},{header:"File",sortable:true,resizable:true,width:100,dataIndex:"filename",menuDisabled:true},{header:"Status",sortable:true,resizable:true,width:100,dataIndex:"status",align:"center",menuDisabled:true},{sortable:true,resizable:true,width:150,dataIndex:"percentage",format:"00 %",menuDisabled:true},{header:"Total size",sortable:true,resizable:true,width:150,dataIndex:"size",align:"right",menuDisabled:true},{header:"ETA",sortable:true,resizable:true,width:100,dataIndex:"timeleft",align:"right",menuDisabled:true},{header:"Age",sortable:true,resizable:true,width:100,dataIndex:"avg_age",align:"right",menuDisabled:true}]});SABnzbd.views.queue.Grid.superclass.initComponent.apply(this,arguments);this.initListeners()},initListeners:function(){}});